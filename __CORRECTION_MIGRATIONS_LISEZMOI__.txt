â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                           â•‘
â•‘              âœ… CORRECTION TERMINÃ‰E - Migrations Alembic                  â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Date : 31 dÃ©cembre 2025
ğŸ”§ Type : Correction de conflit de migrations
âœ… Statut : RÃ‰SOLU ET TESTÃ‰


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PROBLÃˆME INITIAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Lors de l'installation sur un nouvel ordinateur, l'erreur suivante apparaissait :

  âŒ UserWarning: Revision 012 is present more than once
  âŒ KeyError: '012_enlarge_tarif_code_columns'

Cause : Deux fichiers de migration portaient le numÃ©ro "012"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SOLUTION APPLIQUÃ‰E
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Suppression du doublon (012_augmenter_taille_tarif_codes.py)
âœ“ Renommage de la rÃ©vision 012 en 012_enlarge_tarif_code_columns
âœ“ Correction de la chaÃ®ne de migrations (009 â†’ 010 â†’ 011 â†’ 012 â†’ 003 â†’ 004)
âœ“ Suppression du cache Python
âœ“ VÃ©rification complÃ¨te de la cohÃ©rence


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ORDRE FINAL DES MIGRATIONS (VÃ‰RIFIÃ‰ âœ“)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

 1. 001_initial
     â†“
 2. 002_multi_client
     â†“
 3. 009 (add_naissance_maj)
     â†“
 4. 010 (remove_naissance_from_donnee_enqueteur)
     â†“
 5. 011 (partner_tables)
     â†“
 6. 012_enlarge_tarif_code_columns
     â†“
 7. 003_client_id_facturation
     â†“
 8. 004_tarif_enqueteur_client

âœ“ 8 migrations trouvÃ©es
âœ“ Aucune erreur dÃ©tectÃ©e
âœ“ Aucun doublon
âœ“ Toutes les rÃ©fÃ©rences sont valides


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  INSTALLATION SUR UN NOUVEL ORDINATEUR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš¡ MÃ‰THODE RAPIDE (Windows)

  Double-cliquez sur : INSTALLER_BASE_DONNEES.bat


ğŸ“ MÃ‰THODE MANUELLE

  1. DÃ©marrer PostgreSQL
     > net start postgresql-x64-16

  2. Configurer DATABASE_URL
     Git Bash :
     > export DATABASE_URL="postgresql+psycopg2://postgres:MdP@localhost:5432/eos_db"

     PowerShell :
     > $env:DATABASE_URL="postgresql+psycopg2://postgres:MdP@localhost:5432/eos_db"

  3. Appliquer les migrations
     > python backend/apply_migrations.py

  4. DÃ©marrer l'application
     > DEMARRER_EOS_COMPLET.bat


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  OUTILS CRÃ‰Ã‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“„ verifier_migrations.py
   â†’ Script Python pour vÃ©rifier la cohÃ©rence des migrations
   â†’ Usage : python verifier_migrations.py

ğŸ“„ INSTALLER_BASE_DONNEES.bat
   â†’ Script d'installation automatique pour Windows
   â†’ Usage : Double-clic ou exÃ©cution dans cmd

ğŸ“„ INSTALLATION_RAPIDE.md
   â†’ Guide de dÃ©marrage rapide (1 page)

ğŸ“„ GUIDE_INSTALLATION_APRES_CORRECTION_MIGRATIONS.md
   â†’ Guide complet avec dÃ©pannage

ğŸ“„ CORRECTION_MIGRATIONS_RESUME.md
   â†’ RÃ©sumÃ© dÃ©taillÃ© de la correction

ğŸ“„ archives_documentation/CORRECTIF_MIGRATIONS_DOUBLONS_31_12_2025.md
   â†’ Documentation archivÃ©e de la correction


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FICHIERS MODIFIÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ SUPPRIMÃ‰
   backend/migrations/versions/012_augmenter_taille_tarif_codes.py

âœï¸ MODIFIÃ‰S
   backend/migrations/versions/012_enlarge_tarif_code_columns.py
   backend/migrations/versions/009_add_naissance_maj_to_donnee.py
   backend/migrations/versions/003_add_client_id_to_facturation.py
   backend/migrations/versions/004_add_client_id_to_tarif_enqueteur.py


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  VÃ‰RIFICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Pour vÃ©rifier que tout fonctionne :

  1. VÃ©rifier les migrations
     > python verifier_migrations.py

  2. VÃ©rifier les tables PostgreSQL
     > psql -U postgres -d eos_db -c "\dt"

  3. DÃ©marrer l'application
     > python backend/app.py


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  DÃ‰PANNAGE RAPIDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ "password authentication failed"
   â†’ VÃ©rifiez le mot de passe dans DATABASE_URL

âŒ "could not connect to server"
   â†’ DÃ©marrez PostgreSQL : net start postgresql-x64-16

âŒ "Revision 012 is present more than once"
   â†’ Cette erreur est RÃ‰SOLUE ! Supprimez __pycache__ si elle persiste :
     > Remove-Item -Recurse backend\migrations\versions\__pycache__


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  IMPACT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Aucun impact sur les donnÃ©es existantes
âœ… Aucun changement dans le schÃ©ma de la base de donnÃ©es
âœ… Seulement correction de la structure des fichiers de migration

Les bases de donnÃ©es qui ont dÃ©jÃ  appliquÃ© les migrations continuent de
fonctionner normalement. Cette correction est nÃ©cessaire uniquement pour
les nouvelles installations.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Pour plus d'informations, consultez :
  â†’ INSTALLATION_RAPIDE.md (guide 1 page)
  â†’ GUIDE_INSTALLATION_APRES_CORRECTION_MIGRATIONS.md (guide complet)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

